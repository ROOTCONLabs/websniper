# ghostcheck.py
# description: Wordpress is vulnerable to Ghost Vulnerability, this module will check if RPC is enabled.
# author: @semprix
# reference: https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2015-0235

import urllib2, sys, time, datetime, xmlrpclib

from datetime import datetime

class ghostcheck:

    def __init__(self, core):
        pass

    def run(self):
        # runtime recorder
        starttime = datetime.now()

        print 'Set location of xml-rpc.php:',
        targeturl = raw_input()
        print ""
        print "[*] Starting ghostcheck..."
        request = urllib2.Request(targeturl)
        request.get_method = lambda : 'HEAD'
        try:
        	print "[+] Trying if URL exist"
        	time.sleep(2)
            	response = urllib2.urlopen(request)
            	print ">> Got 200 response, this could be a custom error page, check manually"
            	print "[+] Trying to send data"
            	time.sleep(2)
            	wp_url = targeturl
        	server = xmlrpclib.ServerProxy(wp_url)
          	try:
           	 server.demo.addTwoNumbers(1, 1)
           	 print "** VULNERABLE (XML-RPC Interface is available)"
          	except xmlrpclib.ProtocolError as err:
            	  print "[!] A protocol error occurred"
            	  print "[!] Error code: %d" % err.errcode
        except urllib2.HTTPError:
            print "[!] Got an HTTP Error response"

        print "[!] Done...."
        time.sleep(3)
        print ""
        endtime = datetime.now()
        total = endtime - starttime
        print 'Runtime: ', total
